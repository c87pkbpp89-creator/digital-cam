<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Digital Cam Web</title>

<style>
  body {
    margin: 0;
    background: #111;
    font-family: system-ui, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .camera {
    width: 100%;
    max-width: 420px;
    height: 100%;
    position: relative;
    background: black;
  }

  video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter:
      brightness(0.8)
      contrast(1.54)
      saturate(0.88)
      sepia(0.12)
      hue-rotate(-8deg);
  }

  .top {
    position: absolute;
    top: 12px;
    left: 12px;
    right: 12px;
    display: flex;
    justify-content: space-between;
    color: white;
    font-size: 14px;
  }

  .controls {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 20px;
  }

  button {
    background: #222;
    color: white;
    border: none;
    padding: 14px 18px;
    border-radius: 50%;
    font-size: 14px;
  }

  .shutter {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: white;
  }

  .mode {
    position: absolute;
    bottom: 100px;
    width: 100%;
    text-align: center;
    color: white;
  }
</style>
</head>

<body>
<div class="camera">
  <div class="top">
    <div id="rec">‚óè</div>
    <button onclick="switchCamera()">üîÑ</button>
  </div>

  <video id="video" autoplay playsinline></video>

  <div class="mode" id="mode">PHOTO</div>

  <div class="controls">
    <button onclick="toggleMode()">PHOTO / VIDEO</button>
    <button class="shutter" onclick="shutter()"></button>
  </div>
</div>

<script>
let video = document.getElementById("video");
let modeText = document.getElementById("mode");
let rec = document.getElementById("rec");

let currentMode = "photo";
let facing = "environment";
let mediaStream;
let recorder;
let chunks = [];

async function startCamera() {
  if (mediaStream) {
    mediaStream.getTracks().forEach(track => track.stop());
  }

  mediaStream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: facing },
    audio: true
  });

  video.srcObject = mediaStream;
}

startCamera();

function switchCamera() {
  facing = facing === "user" ? "environment" : "user";
  startCamera();
}

function toggleMode() {
  currentMode = currentMode === "photo" ? "video" : "photo";
  modeText.innerText = currentMode.toUpperCase();
}

function shutter() {
  if (currentMode === "photo") takePhoto();
  else recordVideo();
}

function takePhoto() {
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");

  ctx.filter =
    "brightness(0.8) contrast(1.54) saturate(0.88) sepia(0.12) hue-rotate(-8deg)";
  ctx.drawImage(video, 0, 0);

  const a = document.createElement("a");
  a.href = canvas.toDataURL("image/png");
  a.download = "photo.png";
  a.click();
}

function recordVideo() {
  if (!recorder || recorder.state === "inactive") {
    recorder = new MediaRecorder(mediaStream);
    chunks = [];

    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => {
      const blob = new Blob(chunks, { type: "video/webm" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "video.webm";
      a.click();
    };

    recorder.start();
    rec.style.color = "red";
  } else {
    recorder.stop();
    rec.style.color = "white";
  }
}
</script>
</body>
</html>
